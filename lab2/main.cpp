#include "ProductSystem.h"
#include <cassert>

void runTests() {
    std::cout << "\n*** НАЧАЛО ТЕСТИРОВАНИЯ ***" << std::endl;
    
    // Тест 1: Проверка LSP - все подтипы могут использоваться как Товар
    std::unique_ptr<Товар> молокоТест = std::make_unique<Молоко>("Простоквашино", 85.0, "2025-12-31");
    assert(молокоТест->получитьЦену() == 85.0);
    assert(молокоТест->получитьНаименование() == "Простоквашино");
    
    // Тест 2: Проверка ISP - использование специфичного интерфейса
    Телевизор tvTest("Samsung QLED", 55000.0);
    IЭлектронныйТовар* электронныйТовар = &tvTest;
    электронныйТовар->включить(); // Выведет "ТВ Samsung QLED включен."

    // Тест 3: Проверка DIP - Менеджер работает с абстракцией Товар
    МенеджерМагазина менеджерТест;
    std::vector<std::unique_ptr<Товар>> тестовыйСписок;
    тестовыйСписок.push_back(std::move(молокоТест));
    менеджерТест.инвентаризация(тестовыйСписок); 
    
    std::cout << "*** ТЕСТИРОВАНИЕ ЗАВЕРШЕНО УСПЕШНО ***" << std::endl;
}

int main() {
    std::cout << "--- Система Товаров (Вариант 6) ---" << std::endl;
    
    // Инициализация
    std::vector<std::unique_ptr<Товар>> склад;
    склад.push_back(std::make_unique<Молоко>("Домик в деревне", 90.5, "2025-12-25"));
    склад.push_back(std::make_unique<Телевизор>("LG OLED C2", 120000.0));
    склад.push_back(std::make_unique<Игрушка>("Лего Космос", 4500.0, 6));

    // Сценарий 1: Инвентаризация (DIP)
    МенеджерМагазина менеджер;
    менеджер.инвентаризация(склад);
    
    // Сценарий 2: Использование специфичных функций (ISP)
    std::cout << "\n--- Специфические действия ---" << std::endl;
    
    // Телевизор (IЭлектронныйТовар)
    Телевизор* tv = dynamic_cast<Телевизор*>(склад[1].get());
    if (tv) tv->включить();
    
    // Молоко (IПродовольственныйТовар)
    Молоко* milk = dynamic_cast<Молоко*>(склад[0].get());
    if (milk) std::cout << milk->получитьНаименование() << ": " << milk->проверитьСрокГодности() << std::endl;

    runTests();
    
    return 0;
}