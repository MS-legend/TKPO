#include "TetrisFactory.h"
#include <cassert>

// Функция для тестирования функциональности
void runTests() {
    std::cout << "\n*** НАЧАЛО ТЕСТИРОВАНИЯ ***" << std::endl;
    
    // Тест 1: Проверка Обычной Фабрики 
    ОбычнаяФабрика обычнаяФабрика;
    std::unique_ptr<Фигура> тестОбычная = обычнаяФабрика.создатьФигуру();
    
    // Проверка, что создан либо I, либо J-образный продукт
    assert(dynamic_cast<IОбразнаяФигура*>(тестОбычная.get()) != nullptr || 
           dynamic_cast<JОбразнаяФигура*>(тестОбычная.get()) != nullptr);
    std::cout << "Тест 1: Обычная фабрика успешно создала обычную фигуру. Тип: " << тестОбычная->получитьТип() << std::endl;
    
    // Тест 2: Проверка Супер Фабрики 
    СуперФабрика суперФабрика;
    std::unique_ptr<Фигура> тестСупер = суперФабрика.создатьФигуру();
    
    // Проверка, что создан СуперПродукт
    assert(dynamic_cast<СуперФигура*>(тестСупер.get()) != nullptr);
    std::cout << "Тест 2: Супер фабрика успешно создала супер-фигуру. Тип: " << тестСупер->получитьТип() << std::endl;

    std::cout << "*** ТЕСТИРОВАНИЕ ЗАВЕРШЕНО УСПЕШНО ***" << std::endl;
}

int main() {
    std::cout << "--- Система Генерации Фигур (Factory Method) ---" << std::endl;
    
    // Клиент работает с абстрактной ФабрикойФигур (Creator)
    std::unique_ptr<ФабрикаФигур> текущаяФабрика = std::make_unique<ОбычнаяФабрика>();

    std::cout << "\n--- Генерация 3-х обычных фигур (случайный выбор) ---" << std::endl;
    for (int i = 0; i < 3; ++i) {
        текущаяФабрика->операцияПолученияФигуры();
    }
    
    // Смена ситуации: требуется супер-фигура (клиент просто меняет ConcreteCreator)
    std::cout << "\n--- Смена на Супер Фабрику и генерация ---" << std::endl;
    текущаяФабрика = std::make_unique<СуперФабрика>();
    текущаяФабрика->операцияПолученияФигуры();
    
    runTests();
    
    return 0;
}